# AVATAR_AZURE_X_CSS.md ‚Äì Guia Comparativo

## Vis√£o geral

| Recurso | **azure‚Äëspeech‚Äëviseme‚Äësvg** | **lipsync.js** |
|---------|----------------------------|----------------|
| **Alvo de integra√ß√£o** | Funciona diretamente com o **Azure Speech SDK** (`SpeechSynthesizer.visemeReceived`). | Gen√©rico ‚Äì funciona com qualquer fonte de visemas (Azure, Google, personalizada). |
| **Estilo de implementa√ß√£o** | Manipula o **DOM**: mostra/oculta grupos `<g id="mouth‚ÄëX">` dentro de um avatar SVG. | Adiciona uma **classe CSS** (`.viseme‚ÄëX`) ao elemento SVG; a visibilidade √© controlada via CSS. |
| **Depend√™ncias** | `azure-speech-viseme-svg` (‚âà2‚ÄØKB) + Azure Speech SDK (j√° presente no projeto). | `lipsync.js` (MIT, ~1‚ÄØKB). |
| **Complexidade de configura√ß√£o** | Muito baixa ‚Äì um `npm i` e uma chamada ao helper. | Baixa ‚Äì um `npm i` e um pequeno arquivo CSS. |
| **Desempenho em tempo de execu√ß√£o** | Atualiza√ß√µes diretas ao DOM; overhead insignificante. | Troca de classe CSS; tamb√©m insignificante. |
| **Customiza√ß√£o** | Voc√™ pode editar o helper para mapear qualquer ID de visema para qualquer grupo SVG. | Controle total via CSS (anima√ß√µes, transi√ß√µes). |
| **Necessidade de Docker** | **Nenhuma** ‚Äì puro JS, roda no navegador. | **Nenhuma** ‚Äì puro JS. |
| **Ideal para** | Projetos que j√° utilizam **Azure TTS** e desejam a solu√ß√£o plug‚Äëand‚Äëplay mais r√°pida. | Projetos que preferem estiliza√ß√£o **apenas com CSS** ou que podem mudar o provedor de TTS no futuro. |

---

## Como gerar o avatar 2‚ÄëD (SVG) ‚Äì passo a passo comum

1. **Crie uma imagem de retrato** (foto do usu√°rio).  
2. **Converta para PNG em estilo desenho** usando Stable Diffusion (ou qualquer ferramenta de IA que transforme foto em esbo√ßo).  
3. **Vetorialize para SVG** com `potrace` (instale via `npm i -g potrace`):
   ```bash
   # PNG ‚Üí SVG (arquivo de sa√≠da: avatar.svg)
   potrace portrait.png -s -o public/avatars/avatar.svg
   ```
4. **Edite o SVG** para que cada forma de boca seja um grupo separado:
   ```xml
   <g id="mouth-0"><path ‚Ä¶/></g>   <!-- sil√™ncio -->
   <g id="mouth-1"><path ‚Ä¶/></g>   <!-- AA -->
   ...
   <g id="mouth-20"><path ‚Ä¶/></g>
   ```
   *Voc√™ pode desenhar as formas de boca manualmente no Inkscape ou em outro editor vetorial.*

Coloque o SVG final em `public/avatars/` (ex.: `public/avatars/avatar.svg`).

---

## 1Ô∏è‚É£ Usando **azure‚Äëspeech‚Äëviseme‚Äësvg** (baseado em DOM)

### Instala√ß√£o
```bash
npm i azure-speech-viseme-svg
```

### Componente React (exemplo m√≠nimo)
```tsx
import { useEffect, useRef } from "react";
import {
  SpeechSynthesizer,
  SpeechConfig,
  AudioConfig,
} from "microsoft-cognitiveservices-speech-sdk";
import { applyVisemeToSvg } from "azure-speech-viseme-svg";

export const AvatarAzure = ({ text }: { text: string }) => {
  const svgRef = useRef<SVGSVGElement>(null);

  useEffect(() => {
    const cfg = SpeechConfig.fromSubscription(
      import.meta.env.VITE_AZURE_KEY,
      import.meta.env.VITE_AZURE_REGION
    );
    cfg.speechSynthesisVoiceName = "en-US-AriaNeural";
    const audio = AudioConfig.fromDefaultSpeakerOutput();
    const synth = new SpeechSynthesizer(cfg, audio);

    // üëâ Mapeamento Visema ‚Üí SVG
    synth.visemeReceived = (_, e) => {
      if (svgRef.current) applyVisemeToSvg(svgRef.current, e.visemeId);
    };

    synth.speakTextAsync(text, () => console.log("done"), (err) => console.error(err));
    return () => synth.close();
  }, [text]);

  return (
    <svg ref={svgRef} viewBox="0 0 200 200">
      {/* copie os grupos do avatar.svg aqui ou use <use href="/avatars/avatar.svg"/> */}
    </svg>
  );
};
```

### O que o helper faz
* Esconde **todos** os elementos `<g id="mouth‚Äë*">`.
* Exibe o grupo cujo ID corresponde ao `visemeId` recebido (0‚Äë20).
* N√£o requer CSS ‚Äì a manipula√ß√£o √© feita diretamente no DOM.

---

## 2Ô∏è‚É£ Usando **lipsync.js** (baseado em CSS)

### Instala√ß√£o
```bash
npm i lipsync.js
```

### Arquivo CSS (`src/avatar.css`)
```css
svg g { display: none; }
/* mapeia cada visema para uma classe */
svg.viseme-0 g[id^="mouth-"] { display: none; }
svg.viseme-0 g#mouth-0 { display: block; }
svg.viseme-1 g#mouth-1 { display: block; }
/* repita at√© o visema‚Äë20 */
```

### Componente React (exemplo m√≠nimo)
```tsx
import { useEffect, useRef } from "react";
import {
  SpeechSynthesizer,
  SpeechConfig,
  AudioConfig,
} from "microsoft-cognitiveservices-speech-sdk";
import LipSync from "lipsync.js"; // export default

export const AvatarCSS = ({ text }: { text: string }) => {
  const svgRef = useRef<SVGSVGElement>(null);

  useEffect(() => {
    const cfg = SpeechConfig.fromSubscription(
      import.meta.env.VITE_AZURE_KEY,
      import.meta.env.VITE_AZURE_REGION
    );
    cfg.speechSynthesisVoiceName = "en-US-AriaNeural";
    const audio = AudioConfig.fromDefaultSpeakerOutput();
    const synth = new SpeechSynthesizer(cfg, audio);

    synth.visemeReceived = (_, e) => {
      if (svgRef.current) {
        // remove a classe anterior e adiciona a nova
        svgRef.current.className = `viseme-${e.visemeId}`;
        // opcional: LipSync.setViseme(e.visemeId) para helpers extras
        LipSync.setViseme(e.visemeId);
      }
    };

    synth.speakTextAsync(text, () => console.log("done"), (err) => console.error(err));
    return () => synth.close();
  }, [text]);

  return (
    <svg ref={svgRef} className="viseme-0" viewBox="0 0 200 200">
      {/* copie os grupos do avatar.svg */}
    </svg>
  );
};
```

### Vantagens da abordagem CSS
* Voc√™ pode adicionar **transi√ß√µes** ou **anima√ß√µes** em CSS (ex.: `transition: opacity 0.1s`).
* Trocar o provedor de TTS requer apenas enviar os mesmos valores de `visemeId`.

---

## Checklist r√°pido de decis√£o
| Necessidade | Escolha |
|------------|---------|
| J√° usa Azure Speech SDK e quer plug‚Äëand‚Äëplay sem configura√ß√£o | **azure‚Äëspeech‚Äëviseme‚Äësvg** |
| Prefere estiliza√ß√£o **apenas com CSS**, quer controle f√°cil de anima√ß√µes ou pode mudar de provedor TTS | **lipsync.js** |
| Quer o bundle menor poss√≠vel (ambas s√£o pequenas, mas `lipsync.js` n√£o tem c√≥digo helper extra) | **lipsync.js** |

---

## Dica final
As duas bibliotecas podem coexistir. Comece com `azure‚Äëspeech‚Äëviseme‚Äësvg` para prototipar rapidamente e, se precisar de efeitos visuais mais avan√ßados, migre para a solu√ß√£o baseada em CSS (`lipsync.js`).
